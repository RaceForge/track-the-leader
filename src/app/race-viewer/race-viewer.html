@if (notificationService.notification()) {
<div class="notification" [class]="'notification-' + notificationService.notification()!.type" (click)="notificationService.dismiss()">
	<span class="notification-message">{{ notificationService.notification()!.message }}</span>
	<button class="notification-close" type="button" aria-label="Dismiss notification">Ã—</button>
</div>
}
@if (state.isSelectingStartFinish()) {
<div class="mode-overlay">
	<div class="mode-message">Click Start/Finish line on the track</div>
</div>
}
@if (state.isMarkingCars()) {
<div class="mode-overlay">
		<div class="mode-message">Click on RC cars to mark them ({{ state.manualSelections().length }} selected)</div>
</div>
}
<div class="viewer-container">
	<div class="video-area" [class.full-width]="!state.videoSrc()" [class.mapping]="state.isMapping()" [class.selecting]="state.isSelectingStartFinish()">
		<div class="video-wrapper">
			<app-video-player
				#videoPlayer
				[(videoSrc)]="state.videoSrc"
				(videoLoaded)="onVideoLoadedMetadata()"
			></app-video-player>
			@if (state.videoSrc()) {
			<canvas
				#overlayCanvas
				(click)="onCanvasClick($event)"
				[class.interactive]="state.isMapping() || state.isSelectingStartFinish() || state.isMarkingCars()"
			></canvas>
			}
		</div>
	</div>
	@if (state.videoSrc()) {
	<div class="sidebar">
		<div class="sidebar-header">
			<h2>Leaderboard</h2>
		</div>
		<div class="sidebar-content">
			<ul class="leaderboard-list">
				<li>Waiting for data...</li>
			</ul>
		</div>

		<div class="sidebar-section">
			<app-track-editor
				#trackEditor
				[isActive]="state.mode() === 'mapping' || state.mode() === 'start-finish'"
				[(trackLine)]="state.trackLine"
				[(startIndex)]="state.startIndex"
				(start)="onTrackEditorStart()"
				(modeChange)="onTrackEditorModeChange($event)"
				(completed)="onTrackEditorCompleted()"
				(cancelled)="onTrackEditorCancelled()"
			></app-track-editor>
		</div>

		<div class="sidebar-section">
			<app-car-selection
				[isActive]="state.isMarkingCars()"
				[canMark]="state.canMarkCars()"
				[frameData]="state.currentFrameData()"
				(selectionsChange)="onSelectionsChange($event)"
				(overlaysChange)="onOverlaysChange($event)"
				(confirm)="onConfirmCarSelection()"
				(cancel)="onCancelCarMarking()"
				(modeChange)="onCarSelectionModeChange($event)"
			></app-car-selection>
		</div>

		<div class="sidebar-section">
			<h3>Tracking Controls</h3>
			<div class="controls-group">
				<button (click)="onStartTracking()" [disabled]="!state.canStartTracking()">Start Tracking</button>
			</div>
			<div class="toggles-group">
				<label> <input type="checkbox" disabled /> Boxes </label>
				<label> <input type="checkbox" disabled /> IDs </label>
				<label>
					<input
						type="checkbox"
						[checked]="homographyService.debugMode()"
						(change)="onToggleDebugMode($event)"
						[disabled]="state.mode() !== 'locked'"
					/>
					Stabilized Track Line
				</label>
			</div>
		</div>
	</div>
	}
</div>
