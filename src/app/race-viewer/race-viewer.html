@if (!videoSrc()) {
<div
	class="dropzone"
	[class.dragging]="isDragging()"
	(dragover)="onDragOver($event)"
	(dragleave)="onDragLeave($event)"
	(drop)="onDrop($event)"
>
	<div class="dropzone-content">
		<h1>Track-The-Leader</h1>
		<p>Drag and drop a video file (.mp4, .mov) to start</p>
	</div>
</div>
} @else {
@if (isSelectingStartFinish()) {
<div class="mode-overlay">
	<div class="mode-message">Click Start/Finish line on the track</div>
</div>
}
<div class="viewer-container">
	<div class="video-area" [class.mapping]="isMapping()" [class.selecting]="isSelectingStartFinish()">
		<div class="video-wrapper">
			<video
				#videoPlayer
				[src]="videoSrc()"
				autoplay
				[attr.controls]="mode() === 'normal' || mode() === 'locked' ? true : null"
				(loadedmetadata)="onVideoLoadedMetadata()"
			></video>
			<canvas
				#overlayCanvas
				(click)="onCanvasClick($event)"
				[class.interactive]="isMapping() || isSelectingStartFinish()"
			></canvas>
		</div>
	</div>
	<div class="sidebar">
		<div class="sidebar-header">
			<h2>Leaderboard</h2>
		</div>
		<div class="sidebar-content">
			<ul class="leaderboard-list">
				<li>Waiting for data...</li>
			</ul>
		</div>

		<div class="sidebar-section">
			<h3>Track Mapping</h3>
			@if (mode() === 'normal') {
				<div class="controls-group">
					<button (click)="onSelectTrackLine()">Select Track Line</button>
				</div>
			}
			@if (mode() === 'mapping') {
				<div class="controls-group">
					<button (click)="onUndo()" [disabled]="trackLine().length === 0">Undo</button>
					<button (click)="onReset()" [disabled]="trackLine().length === 0">Reset</button>
					<button (click)="onFinish()" [disabled]="!canFinishMapping()">Finish</button>
				</div>
				<div class="status-text">
					Points: {{ trackLine().length }} @if (!canFinishMapping()) { (need 5+) }
				</div>
			}
			@if (mode() === 'start-finish') {
				<div class="controls-group">
					<button (click)="onConfirmStartFinish()" [disabled]="startIndex() === null">Confirm Start/Finish</button>
					<button (click)="onReset()">Reset</button>
				</div>
			}
			@if (mode() === 'locked') {
				<div class="status-text success">âœ“ Track locked</div>
			}
		</div>

		<div class="sidebar-section">
			<h3>Controls</h3>
			<div class="controls-group">
				<button (click)="onStartTracking()" [disabled]="!canStartTracking()">Start Tracking</button>
			</div>
			<div class="toggles-group">
				<label> <input type="checkbox" disabled /> Boxes </label>
				<label> <input type="checkbox" disabled /> IDs </label>
				<label> <input type="checkbox" disabled /> Track Line </label>
			</div>
		</div>
	</div>
</div>
}
